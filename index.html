<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DG SMS SERVER</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        body { background-color: #0b1120; color: white; font-family: sans-serif; text-align: center; padding: 20px; }
        .container { max-width: 400px; margin: auto; background: #161e2e; padding: 25px; border-radius: 15px; border: 1px solid #1e293b; }
        .balance-box { background: #1e293b; padding: 10px; border-radius: 10px; color: #10b981; font-weight: bold; margin-bottom: 20px; font-size: 20px; }
        select, button { width: 100%; padding: 12px; margin-top: 15px; border-radius: 8px; border: none; background: #1f2937; color: white; font-size: 16px; }
        button { background: #2563eb; cursor: pointer; font-weight: bold; }
        .error-text { color: #f59e0b; font-size: 13px; margin-top: 15px; display: block; }
    </style>
</head>
<body>

<div class="container">
    <h2 style="color: #3b82f6; margin-top: 0;">DG SMS SERVER</h2>
    <div class="balance-box" id="userBalance">‚Çπ0.00</div>

    <select id="smsSvc">
        <option>üîç Connecting to Server...</option>
    </select>

    <button onclick="alert('Fetching number...')">GET OTP NUMBER</button>
    <span id="debugMsg" class="error-text"></span>
</div>

<script>
    // 1. Firebase Sync
    const firebaseConfig = { databaseURL: "https://otp-service-74871-default-rtdb.firebaseio.com/" };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const userUID = "8nfpc1ibBWOGasH830QTdhIOQb23";

    database.ref('users/' + userUID + '/balance').on('value', (snap) => {
        document.getElementById('userBalance').innerText = "‚Çπ" + (snap.val() || 0).toFixed(2);
    });

    // 2. Simple Backend Fetch
    const BACKEND = "https://dg-otp-backend.onrender.com";

    async function getServices() {
        const select = document.getElementById('smsSvc');
        const debug = document.getElementById('debugMsg');
        try {
            const res = await fetch(`${BACKEND}/get-all-services?country=0`);
            const data = await res.json();
            
            if (data.error) throw new Error(data.error);

            select.innerHTML = "";
            data.forEach(s => {
                let opt = document.createElement('option');
                opt.innerText = `${s.name} - ‚Çπ${s.rate}`;
                select.appendChild(opt);
            });
            debug.innerText = "‚úÖ Connection Successful";
        } catch (e) {
            select.innerHTML = "<option>‚ö†Ô∏è Server Error</option>";
            debug.innerText = "Check: 1. Render is Live 2. API Key has balance";
        }
    }
    getServices();
</script>
</body>
</html>
