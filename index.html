<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DG SOCIAL SERVICE - Premium Panel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --accent: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --bg: #0f172a;
            --bg-light: #1e293b;
            --card-bg: rgba(30, 41, 59, 0.8);
            --card-border: rgba(99, 102, 241, 0.2);
            --text: #f1f5f9;
            --text-light: #94a3b8;
            --sidebar-bg: #0f172a;
            --shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(16, 185, 129, 0.1) 0%, transparent 50%);
        }

        /* Glow effects */
        .glow-effect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            background: radial-gradient(circle at 20% 80%, rgba(99, 102, 241, 0.1) 0%, transparent 40%),
                       radial-gradient(circle at 80% 20%, rgba(16, 185, 129, 0.08) 0%, transparent 40%);
        }

        /* Auth Screen */
        #authBox {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: var(--bg);
        }

        .auth-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--card-border);
            border-radius: 20px;
            padding: 40px 35px;
            width: 100%;
            max-width: 420px;
            text-align: center;
            box-shadow: var(--shadow);
            animation: slideUp 0.5s ease-out;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 30px;
            color: var(--primary);
            font-size: 28px;
            font-weight: 700;
        }

        .logo-icon {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .auth-form {
            margin-top: 25px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-light);
            font-size: 14px;
            font-weight: 500;
        }

        .input-field {
            width: 100%;
            padding: 14px 18px;
            border-radius: 12px;
            background: rgba(15, 23, 42, 0.7);
            border: 1px solid rgba(99, 102, 241, 0.3);
            color: var(--text);
            font-size: 15px;
            outline: none;
            transition: var(--transition);
        }

        .input-field:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
        }

        .btn-google {
            background: white;
            color: #333;
            margin-top: 10px;
            border: 1px solid #ddd;
        }

        .btn-google:hover {
            background: #f8f9fa;
            transform: translateY(-2px);
        }

        .auth-switch {
            margin-top: 25px;
            color: var(--text-light);
            font-size: 14px;
        }

        .auth-link {
            color: var(--primary);
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
        }

        .auth-link:hover {
            text-decoration: underline;
        }

        /* App Container */
        #app {
            display: none;
        }

        /* Top Bar */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(99, 102, 241, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .menu-toggle {
            width: 44px;
            height: 44px;
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 5px;
            cursor: pointer;
            transition: var(--transition);
        }

        .menu-toggle:hover {
            background: rgba(99, 102, 241, 0.2);
            transform: scale(1.05);
        }

        .menu-toggle span {
            display: block;
            width: 20px;
            height: 2px;
            background: var(--primary);
            border-radius: 10px;
            transition: var(--transition);
        }

        .menu-toggle span:nth-child(2) {
            width: 16px;
            align-self: flex-start;
            margin-left: 2px;
        }

        .wallet-card {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(79, 70, 229, 0.1));
            padding: 8px 16px;
            border-radius: 12px;
            border: 1px solid rgba(99, 102, 241, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .wallet-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.2);
        }

        .wallet-icon {
            color: var(--accent);
            font-size: 16px;
        }

        .wallet-balance {
            color: var(--accent);
            font-weight: 700;
            font-size: 16px;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 0;
            left: -280px;
            width: 260px;
            height: 100%;
            background: var(--sidebar-bg);
            border-right: 1px solid rgba(99, 102, 241, 0.1);
            z-index: 1000;
            transition: var(--transition);
            padding: 25px 20px;
            box-shadow: 10px 0 40px rgba(0, 0, 0, 0.5);
            overflow-y: auto;
        }

        .sidebar.active {
            left: 0;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .sidebar-logo {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .sidebar-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary);
        }

        .sidebar-user {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(99, 102, 241, 0.1);
            border-radius: 12px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: var(--transition);
        }

        .sidebar-user:hover {
            background: rgba(99, 102, 241, 0.15);
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: 2px solid var(--primary);
            overflow: hidden;
            background: var(--bg-light);
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-info-sidebar {
            flex: 1;
        }

        .user-name-sidebar {
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
        }

        .user-email-sidebar {
            font-size: 11px;
            color: var(--text-light);
        }

        .sidebar-menu {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .menu-item {
            padding: 12px 14px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-light);
            text-decoration: none;
            font-size: 14px;
        }

        .menu-item:hover {
            background: rgba(99, 102, 241, 0.1);
            color: var(--text);
            transform: translateX(5px);
        }

        .menu-item.active {
            background: rgba(99, 102, 241, 0.15);
            color: var(--text);
            border-left: 3px solid var(--primary);
            font-weight: 600;
        }

        .menu-item i {
            width: 20px;
            font-size: 16px;
        }

        .menu-item.logout {
            margin-top: 20px;
            color: var(--danger);
            border-left: 3px solid var(--danger);
        }

        /* Main Content */
        .main-content {
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
            padding-bottom: 100px;
        }

        .page {
            display: none;
            animation: fadeIn 0.4s ease-out;
        }

        .page.active {
            display: block;
        }

        .page-header {
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .page-title {
            font-size: 26px;
            font-weight: 700;
            color: var(--text);
        }

        .page-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 18px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .card-icon {
            width: 44px;
            height: 44px;
            background: rgba(99, 102, 241, 0.15);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: var(--primary);
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text);
        }

        /* Order Form */
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-col {
            flex: 1;
        }

        .select-field, .input-field {
            width: 100%;
            padding: 14px 18px;
            border-radius: 12px;
            background: rgba(15, 23, 42, 0.7);
            border: 1px solid rgba(99, 102, 241, 0.3);
            color: var(--text);
            font-size: 15px;
            outline: none;
            transition: var(--transition);
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%236366f1' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 18px center;
            background-size: 18px;
            padding-right: 45px;
        }

        .select-field:focus, .input-field:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        .price-box {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .price-label {
            color: var(--text-light);
            font-size: 16px;
        }

        .price-amount {
            color: var(--accent);
            font-weight: 800;
            font-size: 24px;
        }

        /* Support Cards */
        .support-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }

        .support-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 16px;
            padding: 25px;
            display: flex;
            align-items: center;
            gap: 20px;
            text-decoration: none;
            color: var(--text);
            transition: var(--transition);
        }

        .support-card:hover {
            transform: translateY(-5px);
            background: rgba(99, 102, 241, 0.1);
        }

        .support-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
        }

        .support-info h4 {
            font-size: 18px;
            margin-bottom: 5px;
        }

        .support-info p {
            color: var(--text-light);
            font-size: 14px;
        }

        /* Profile */
        .profile-card {
            text-align: center;
            padding: 30px;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 4px solid var(--primary);
            margin: 0 auto 20px;
            overflow: hidden;
            background: var(--bg-light);
        }

        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-name {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .profile-email {
            color: var(--text-light);
            font-size: 16px;
            margin-bottom: 25px;
        }

        /* Admin Panel */
        .admin-section {
            margin-bottom: 30px;
        }

        .admin-user-card {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-info h5 {
            font-size: 16px;
            margin-bottom: 5px;
        }

        .user-details {
            display: flex;
            gap: 15px;
            font-size: 13px;
            color: var(--text-light);
        }

        .admin-actions {
            display: flex;
            gap: 10px;
        }

        .btn-sm {
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-sm:hover {
            transform: translateY(-2px);
        }

        .btn-primary-sm {
            background: var(--primary);
            color: white;
        }

        .btn-warning-sm {
            background: var(--warning);
            color: white;
        }

        .btn-success-sm {
            background: var(--accent);
            color: white;
        }

        .btn-danger-sm {
            background: var(--danger);
            color: white;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-around;
            padding: 15px 0;
            border-top: 1px solid rgba(99, 102, 241, 0.1);
            z-index: 100;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-light);
            cursor: pointer;
            transition: var(--transition);
            padding: 5px 15px;
            border-radius: 12px;
        }

        .nav-item:hover {
            color: var(--primary);
        }

        .nav-item.active {
            color: var(--primary);
            background: rgba(99, 102, 241, 0.1);
        }

        .nav-icon {
            font-size: 22px;
            margin-bottom: 5px;
        }

        .nav-label {
            font-size: 12px;
            font-weight: 600;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .auth-card {
                padding: 30px 25px;
            }
            
            .form-row {
                flex-direction: column;
                gap: 10px;
            }
            
            .support-grid {
                grid-template-columns: 1fr;
            }
            
            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }

        /* Commission Display */
        .commission-display {
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            text-align: center;
        }

        .commission-value {
            font-size: 32px;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .commission-label {
            color: var(--text-light);
            font-size: 16px;
        }

        /* Commission Input Box */
        .commission-input-container {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-top: 20px;
        }

        .commission-input-box {
            flex: 1;
        }

        .commission-input {
            width: 100%;
            padding: 16px 20px;
            border-radius: 12px;
            background: rgba(15, 23, 42, 0.7);
            border: 1px solid rgba(99, 102, 241, 0.3);
            color: var(--text);
            font-size: 16px;
            outline: none;
            transition: var(--transition);
        }

        .commission-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        .commission-input::placeholder {
            color: var(--text-light);
            opacity: 0.7;
        }

        /* Orders Table */
        .orders-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .orders-table th {
            background: rgba(99, 102, 241, 0.1);
            padding: 12px;
            text-align: left;
            color: var(--text-light);
            font-weight: 600;
            font-size: 14px;
        }

        .orders-table td {
            padding: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 14px;
        }

        .status-pending {
            color: var(--warning);
            font-weight: 600;
        }

        .status-completed {
            color: var(--accent);
            font-weight: 600;
        }

        .status-failed {
            color: var(--danger);
            font-weight: 600;
        }

        /* Referral Section */
        .referral-box {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(79, 70, 229, 0.1));
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            margin-bottom: 20px;
        }

        .referral-code {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--primary);
            border-radius: 10px;
            padding: 15px;
            font-size: 20px;
            font-weight: 700;
            letter-spacing: 2px;
            margin: 15px 0;
            color: var(--primary);
        }

        /* API Section */
        .api-key-box {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--accent);
            border-radius: 10px;
            padding: 15px;
            font-family: monospace;
            word-break: break-all;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="glow-effect"></div>

    <!-- Authentication Screen -->
    <div id="authBox">
        <div class="auth-card">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-rocket"></i>
                </div>
                <span>DG SOCIAL SERVICE</span>
            </div>
            
            <!-- Login Form -->
            <div id="loginForm" class="auth-form">
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" id="loginEmail" placeholder="Enter your email" class="input-field">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" id="loginPass" placeholder="Enter your password" class="input-field">
                </div>
                
                <button class="btn btn-primary" onclick="doLogin()">
                    <i class="fas fa-sign-in-alt"></i> Sign In
                </button>
                
                <button class="btn btn-google" onclick="doGoogleAuth()">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18" alt="Google">
                    Continue with Google
                </button>
                
                <div class="auth-switch">
                    New to DG Social Service? 
                    <span class="auth-link" onclick="toggleAuth(false)">Create Account</span>
                </div>
            </div>
            
            <!-- Signup Form -->
            <div id="signupForm" class="auth-form" style="display: none;">
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <input type="text" id="signupName" placeholder="Enter your full name" class="input-field">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" id="signupEmail" placeholder="Enter your email" class="input-field">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" id="signupPass" placeholder="Create a password (min. 6 characters)" class="input-field">
                </div>
                
                <button class="btn btn-primary" onclick="doSignup()">
                    <i class="fas fa-user-plus"></i> Create Account
                </button>
                
                <button class="btn btn-google" onclick="doGoogleAuth()">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18" alt="Google">
                    Sign up with Google
                </button>
                
                <div class="auth-switch">
                    Already have an account? 
                    <span class="auth-link" onclick="toggleAuth(true)">Sign In</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="app">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <i class="fas fa-rocket"></i>
                </div>
                <div class="sidebar-title">DG PANEL</div>
            </div>
            
            <!-- User Profile in Sidebar -->
            <div class="sidebar-user" onclick="openPage('profile')">
                <div class="user-avatar">
                    <img id="sidebarPfp" src="" alt="Profile">
                </div>
                <div class="user-info-sidebar">
                    <div class="user-name-sidebar" id="sidebarName">User</div>
                    <div class="user-email-sidebar" id="sidebarEmail">user@email.com</div>
                </div>
                <i class="fas fa-chevron-right" style="color: var(--text-light); font-size: 12px;"></i>
            </div>
            
            <div class="sidebar-menu">
                <a class="menu-item active" onclick="openPage('home', this)">
                    <i class="fas fa-bolt"></i>
                    <span>New Order</span>
                </a>
                
                <a class="menu-item" onclick="openPage('orders', this)">
                    <i class="fas fa-list"></i>
                    <span>Orders</span>
                </a>
                
                <a class="menu-item" onclick="openPage('refill', this)">
                    <i class="fas fa-history"></i>
                    <span>Refill History</span>
                </a>
                
                <a class="menu-item" onclick="openPage('services', this)">
                    <i class="fas fa-cogs"></i>
                    <span>Services</span>
                </a>
                
                <a class="menu-item" onclick="openPage('addfund', this)">
                    <i class="fas fa-wallet"></i>
                    <span>Deposit</span>
                </a>
                
                <a class="menu-item" onclick="openPage('tickets', this)">
                    <i class="fas fa-ticket-alt"></i>
                    <span>Tickets</span>
                </a>
                
                <a class="menu-item" onclick="openPage('api', this)">
                    <i class="fas fa-code"></i>
                    <span>API</span>
                </a>
                
                <a class="menu-item" onclick="openPage('refer', this)">
                    <i class="fas fa-gift"></i>
                    <span>Refer & Earn</span>
                </a>
                
                <a class="menu-item" onclick="openPage('support', this)">
                    <i class="fas fa-headset"></i>
                    <span>Support</span>
                </a>
                
                <a class="menu-item" onclick="openPage('profile', this)">
                    <i class="fas fa-user-circle"></i>
                    <span>My Profile</span>
                </a>
                
                <a id="adminBtn" class="menu-item" style="display: none; color: #f87171;" onclick="openPage('admin', this)">
                    <i class="fas fa-lock"></i>
                    <span>Admin Panel</span>
                </a>
                
                <a class="menu-item logout" onclick="doLogout()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
            </div>
        </div>

        <!-- Top Bar -->
        <div class="top-bar">
            <div class="menu-toggle" onclick="toggleSidebar(true)">
                <span></span>
                <span></span>
                <span></span>
            </div>
            
            <div class="wallet-card" onclick="openPage('addfund')">
                <i class="fas fa-wallet wallet-icon"></i>
                <div>
                    <div style="font-size: 11px; color: var(--text-light);">Balance</div>
                    <div class="wallet-balance">₹<span id="balText">0.00</span></div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Home Page -->
            <div id="home" class="page active">
                <div class="page-header">
                    <div class="page-icon">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <div>
                        <h1 class="page-title">Create New Order</h1>
                        <p style="color: var(--text-light);">Order social media services instantly</p>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <h2 class="card-title">Order Details</h2>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label class="form-label">Category</label>
                            <select id="catSelect" class="select-field" onchange="fetchServicesFromAPI()">
                                <option value="">Select Category ▼</option>
                                <option value="Instagram">Instagram</option>
                                <option value="YouTube">YouTube</option>
                                <option value="Telegram">Telegram</option>
                                <option value="Facebook">Facebook</option>
                                <option value="Twitter">Twitter</option>
                                <option value="TikTok">TikTok</option>
                            </select>
                        </div>
                        
                        <div class="form-col">
                            <label class="form-label">Service</label>
                            <select id="srvSelect" class="select-field" onchange="calculateAutoPrice()">
                                <option value="">Choose Service ▼</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Link / Username</label>
                        <input type="text" id="orderLink" placeholder="Paste your profile or post link" class="input-field">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Quantity</label>
                        <input type="number" id="orderQty" value="100" min="10" step="10" class="input-field" oninput="calculateAutoPrice()">
                    </div>
                    
                    <div class="price-box">
                        <div class="price-label">Total Amount</div>
                        <div class="price-amount">₹<span id="totalPrice">0.00</span></div>
                    </div>
                    
                    <button class="btn btn-primary" id="orderBtn" onclick="placeFinalOrder()">
                        <i class="fas fa-paper-plane"></i> Place Order Now
                    </button>
                </div>
            </div>

            <!-- Orders Page -->
            <div id="orders" class="page">
                <div class="page-header">
                    <div class="page-icon">
                        <i class="fas fa-list"></i>
                    </div>
                    <div>
                        <h1 class="page-title">My Orders</h1>
                        <p style="color: var(--text-light);">View your order history</p>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-history"></i>
                        </div>
                        <h2 class="card-title">Recent Orders</h2>
                    </div>
                    
                    <table class="orders-table">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Service</th>
                                <th>Quantity</th>
                                <th>Amount</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="ordersList">
                            <!-- Orders will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Refill History Page -->
            <div id="refill" class="page">
                <div class="page-header">
                    <div class="page-icon">
                        <i class="fas fa-history"></i>
                    </div>
                    <div>
                        <h1 class="page-title">Refill History</h1>
                        <p style="color: var(--text-light);">Track your refill requests</p>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-sync-alt"></i>
                        </div>
                        <h2 class="card-title">Refill Requests</h2>
                    </div>
                    
                    <table class="orders-table">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Service</th>
                                <th>Date</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="refillList">
                            <!-- Refill history will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Services Page -->
            <div id="services" class="page">
                <div class="page-header">
                    <div class="page-icon">
                        <i class="fas fa-cogs"></i>
                    </div>
                    <div>
                        <h1 class="page-title">All Services</h1>
                        <p style="color: var(--text-light);">Browse available services</p>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-th-list"></i>
                        </div>
                        <h2 class="card-title">Service Categories</h2>
                    </div>
                    
                    <div id="allServices">
                        <!-- Services will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Deposit Page -->
            <div id="addfund" class="page">
                <div class="page-header">
                    <div class="page-icon">
                        <i class="fas fa-wallet"></i>
                    </div>
                    <div>
                        <h1 class="page-title">Deposit Funds</h1>
                        <p style="color: var(--text-light);">Recharge your wallet instantly</p>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-qrcode"></i>
                        </div>
                        <h2 class="card-title">Payment Details</h2>
                    </div>
                    
                    <div style="background: rgba(99, 102, 241, 0.1); padding: 20px; border-radius: 12px; margin-bottom: 25px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <i class="fas fa-university" style="color: var(--primary);"></i>
                            <span style="font-weight: 600;">UPI ID:</span>
                        </div>
                        <div style="font-size: 22px; font-weight: 700; color: var(--primary);">aqdaskhan03@fam</div>
                        <p style="color: var(--text-light); margin-top: 10px; font-size: 14px;">Send payment to this UPI ID and enter UTR below</p>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Amount (₹)</label>
                        <input type="number" id="amtInp" placeholder="Enter amount to add" class="input-field">
                    </div>
                    
                    <button class="btn btn-primary" onclick="genQR()">
                        <i class="fas fa-qrcode"></i> Generate Payment QR
                    </button>
                    
                    <div id="qrDiv" style="display: none; text-align: center; margin-top: 25px;">
                        <div style="background: white; padding: 15px; border-radius: 12px; display: inline-block; margin-bottom: 20px;">
                            <img id="qrImg" src="" style="width: 200px; height: 200px;">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">UTR / Transaction ID</label>
                            <input type="text" id="utrInp" placeholder="Enter UTR from your payment" class="input-field">
                        </div>
                        
                        <button class="btn btn-success-sm" style="width: 100%; padding: 15px; font-size: 16px;" onclick="submitUTR()">
                            <i class="fas fa-check-circle"></i> Confirm Payment
                        </button>
                    </div>
                </div>
            </div>

            <!-- Tickets Page -->
            <div id="tickets" class="page">
                <div class="page-header">
                    <div class="page-icon">
                        <i class="fas fa-ticket-alt"></i>
                    </div>
                    <div>
                        <h1 class="page-title">Support Tickets</h1>
                        <p style="color: var(--text-light);">Manage your support tickets</p>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-plus-circle"></i>
                        </div>
                        <h2 class="card-title">Create New Ticket</h2>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Subject</label>
                        <input type="text" id="ticketSubject" placeholder="Enter ticket subject" class="input-field">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Message</label>
                        <textarea id="ticketMessage" placeholder="Describe your issue" class="input-field" rows="4"></textarea>
                    </div>
                    
                    <button class="btn btn-primary" onclick="createTicket()">
                        <i class="fas fa-paper-plane"></i> Submit Ticket
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-list"></i>
                        </div>
                        <h2 class="card-title">My Tickets</h2>
                    </div>
                    
                    <div id="ticketsList">
                        <!-- Tickets will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- API Page -->
            <div id="api" class="page">
                <div class="page-header">
                    <div class="page-icon">
                        <i class="fas fa-code"></i>
                    </div>
                    <div>
                        <h1 class="page-title">API Documentation</h1>
                        <p style="color: var(--text-light);">Integrate with our API</p>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-key"></i>
                        </div>
                        <h2 class="card-title">Your API Key</h2>
                    </div>
                    
                    <div class="api-key-box" id="apiKeyDisplay">
                        Loading API key...
                    </div>
                    
                    <button class="btn btn-primary" onclick="generateAPIKey()">
                        <i class="fas fa-key"></i> Generate New API Key
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-book"></i>
                        </div>
                        <h2 class="card-title">API Endpoints</h2>
                    </div>
                    
                    <div style="background: rgba(0, 0, 0, 0.3); border-radius: 10px; padding: 15px; margin-bottom: 15px;">
                        <h4 style="color: var(--primary); margin-bottom: 10px;">GET /services</h4>
                        <p style="color: var(--text-light); font-size: 14px;">Get list of all available services</p>
                        <code style="color: var(--accent); font-size: 12px;">{api_url}/get-services?category=Instagram&api_key=YOUR_API_KEY</code>
                    </div>
                    
                    <div style="background: rgba(0, 0, 0, 0.3); border-radius: 10px; padding: 15px;">
                        <h4 style="color: var(--primary); margin-bottom: 10px;">POST /order</h4>
                        <p style="color: var(--text-light); font-size: 14px;">Place a new order</p>
                        <code style="color: var(--accent); font-size: 12px;">{api_url}/place-order (POST with JSON body)</code>
                    </div>
                </div>
            </div>

            <!-- Refer & Earn Page -->
            <div id="refer" class="page">
                <div class="page-header">
                    <div class="page-icon">
                        <i class="fas fa-gift"></i>
                    </div>
                    <div>
                        <h1 class="page-title">Refer & Earn</h1>
                        <p style="color: var(--text-light);">Invite friends and earn rewards</p>
                    </div>
                </div>
                
                <div class="referral-box">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">Your Referral Link</h3>
                    <div class="referral-code" id="referralCode">
                        Loading...
                    </div>
                    <button class="btn btn-primary" onclick="copyReferralLink()" style="width: auto; padding: 10px 25px;">
                        <i class="fas fa-copy"></i> Copy Link
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <h2 class="card-title">Referral Statistics</h2>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 15px;">
                        <div style="background: rgba(99, 102, 241, 0.1); padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 28px; font-weight: 700; color: var(--primary);" id="refCount">0</div>
                            <div style="color: var(--text-light); font-size: 14px;">Total Referrals</div>
                        </div>
                        
                        <div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 28px; font-weight: 700; color: var(--accent);" id="refEarned">₹0.00</div>
                            <div style="color: var(--text-light); font-size: 14px;">Earned</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Support Page -->
            <div id="support" class="page">
                <div class="page-header">
                    <div class="page-icon">
                        <i class="fas fa-headset"></i>
                    </div>
                    <div>
                        <h1 class="page-title">24/7 Support</h1>
                        <p style="color: var(--text-light);">We're here to help you anytime</p>
                    </div>
                </div>
                
                <div class="support-grid">
                    <a href="https://wa.me/917775965170" target="_blank" class="support-card">
                        <div class="support-icon" style="background: linear-gradient(135deg, #25D366, #128C7E);">
                            <i class="fab fa-whatsapp"></i>
                        </div>
                        <div class="support-info">
                            <h4>WhatsApp Support</h4>
                            <p>Instant chat support via WhatsApp</p>
                        </div>
                    </a>
                    
                    <a href="https://t.me/dgservice_support" target="_blank" class="support-card">
                        <div class="support-icon" style="background: linear-gradient(135deg, #0088cc, #006699);">
                            <i class="fab fa-telegram"></i>
                        </div>
                        <div class="support-info">
                            <h4>Telegram Channel</h4>
                            <p>Join our Telegram for updates & support</p>
                        </div>
                    </a>
                    
                    <a href="https://www.instagram.com/dg.service.1?igsh=NXR0bWQ1N24zcGxq" target="_blank" class="support-card">
                        <div class="support-icon" style="background: linear-gradient(135deg, #E4405F, #C13584);">
                            <i class="fab fa-instagram"></i>
                        </div>
                        <div class="support-info">
                            <h4>Instagram</h4>
                            <p>Follow us on Instagram</p>
                        </div>
                    </a>
                </div>
            </div>

            <!-- Profile Page -->
            <div id="profile" class="page">
                <div class="page-header">
                    <div class="page-icon">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div>
                        <h1 class="page-title">My Profile</h1>
                        <p style="color: var(--text-light);">Manage your account details</p>
                    </div>
                </div>
                
                <div class="card profile-card">
                    <div class="profile-avatar">
                        <img id="uPfp" src="" alt="Profile Picture">
                    </div>
                    
                    <h2 class="profile-name" id="uName">User</h2>
                    <p class="profile-email" id="uEmail">user@example.com</p>
                    
                    <div style="display: flex; gap: 15px; justify-content: center; margin-top: 20px;">
                        <div style="text-align: center; padding: 15px; background: rgba(99, 102, 241, 0.1); border-radius: 12px; min-width: 120px;">
                            <div style="font-size: 24px; font-weight: 700; color: var(--accent);">₹<span id="profileBal">0.00</span></div>
                            <div style="font-size: 14px; color: var(--text-light);">Balance</div>
                        </div>
                        
                        <div style="text-align: center; padding: 15px; background: rgba(99, 102, 241, 0.1); border-radius: 12px; min-width: 120px;">
                            <div style="font-size: 24px; font-weight: 700; color: var(--primary);" id="userStatus">Active</div>
                            <div style="font-size: 14px; color: var(--text-light);">Status</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin Page -->
            <div id="admin" class="page">
                <div class="page-header">
                    <div class="page-icon">
                        <i class="fas fa-lock"></i>
                    </div>
                    <div>
                        <h1 class="page-title">Admin Dashboard</h1>
                        <p style="color: var(--text-light);">Manage users, payments & settings</p>
                    </div>
                </div>
                
                <div class="admin-section">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">
                                <i class="fas fa-percentage"></i>
                            </div>
                            <h2 class="card-title">Commission Settings</h2>
                        </div>
                        
                        <div class="commission-display">
                            <div class="commission-value" id="currentCommission">0%</div>
                            <div class="commission-label">Current Commission Rate</div>
                        </div>
                        
                        <p style="color: var(--text-light); margin-bottom: 20px;">Set commission percentage added to all service prices</p>
                        
                        <div class="commission-input-container">
                            <div class="commission-input-box">
                                <input type="number" id="commInput" placeholder="Enter commission percentage (e.g., 15.5 for 15.5%)" class="commission-input" min="0" max="100" step="0.5">
                            </div>
                            <button class="btn btn-primary-sm" onclick="updateComm()" style="padding: 16px 30px; font-size: 16px;">
                                Update Commission
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="admin-section">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <h2 class="card-title">User Management</h2>
                        </div>
                        
                        <div id="adminUserList" style="max-height: 400px; overflow-y: auto;">
                            <!-- User list will be loaded here -->
                        </div>
                    </div>
                </div>
                
                <div class="admin-section">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon">
                                <i class="fas fa-rupee-sign"></i>
                            </div>
                            <h2 class="card-title">Payment Requests</h2>
                        </div>
                        
                        <div id="adminPayments">
                            <!-- Payment requests will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <div class="nav-item active" onclick="openPage('home', this)">
                <div class="nav-icon">
                    <i class="fas fa-home"></i>
                </div>
                <div class="nav-label">Home</div>
            </div>
            
            <div class="nav-item" onclick="openPage('addfund', this)">
                <div class="nav-icon">
                    <i class="fas fa-wallet"></i>
                </div>
                <div class="nav-label">Deposit</div>
            </div>
            
            <div class="nav-item" onclick="openPage('orders', this)">
                <div class="nav-icon">
                    <i class="fas fa-list"></i>
                </div>
                <div class="nav-label">Orders</div>
            </div>
            
            <div class="nav-item" onclick="openPage('support', this)">
                <div class="nav-icon">
                    <i class="fas fa-headset"></i>
                </div>
                <div class="nav-label">Help</div>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDkWf5kB35rbr6fQp5EJxwZ2bG6xzDlzZQ",
            authDomain: "otp-service-74871.firebaseapp.com",
            databaseURL: "https://otp-service-74871-default-rtdb.firebaseio.com"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();
        
        // Constants
        const MY_UID = "ndjVRXUrm7byZUhfAMnIBhxUA0F3";
        const BACKEND_URL = "https://dg-otp-backend.onrender.com";
        let globalComm = 0;
        
        // Auth State Listener
        auth.onAuthStateChanged(user => {
            if (user) {
                // Check if user is blocked
                db.ref('users/' + user.uid + '/status').on('value', snap => {
                    if (snap.val() === 'blocked') {
                        alert("Your account has been blocked!");
                        auth.signOut();
                        return;
                    }
                    document.getElementById('userStatus').innerText = snap.val() || 'Active';
                });
                
                // Show app, hide auth
                document.getElementById('authBox').style.display = 'none';
                document.getElementById('app').style.display = 'block';
                
                // Update user profile
                const displayName = user.displayName || 'User';
                const email = user.email || 'user@email.com';
                const photoURL = user.photoURL || "https://ui-avatars.com/api/?name=" + encodeURIComponent(displayName) + "&background=6366f1&color=fff";
                
                document.getElementById('uName').innerText = displayName;
                document.getElementById('uEmail').innerText = email;
                document.getElementById('uPfp').src = photoURL;
                
                // Update sidebar profile
                document.getElementById('sidebarName').innerText = displayName;
                document.getElementById('sidebarEmail').innerText = email;
                document.getElementById('sidebarPfp').src = photoURL;
                
                // Load commission
                db.ref('settings/commission').on('value', snap => {
                    globalComm = snap.val() || 0;
                    if (user.uid === MY_UID) {
                        document.getElementById('commInput').value = globalComm;
                        document.getElementById('currentCommission').innerText = globalComm + "%";
                    }
                });
                
                // Show admin button for admin
                if (user.uid === MY_UID) {
                    document.getElementById('adminBtn').style.display = 'flex';
                    loadAdminPanel();
                }
                
                // Load balance
                db.ref('users/' + user.uid + '/balance').on('value', snap => {
                    const balance = (snap.val() || 0).toFixed(2);
                    document.getElementById('balText').innerText = balance;
                    document.getElementById('profileBal').innerText = balance;
                });
                
                // Load user data for other pages
                loadOrders();
                loadRefillHistory();
                loadAllServices();
                loadTickets();
                loadAPIKey();
                loadReferralData();
                
            } else {
                // Show auth, hide app
                document.getElementById('authBox').style.display = 'flex';
                document.getElementById('app').style.display = 'none';
            }
        });
        
        // Commission Update
        function updateComm() {
            const val = parseFloat(document.getElementById('commInput').value);
            if (isNaN(val) || val < 0 || val > 100) {
                alert("Please enter a valid commission percentage (0-100)");
                return;
            }
            
            db.ref('settings/commission').set(val).then(() => {
                alert("Commission updated successfully to " + val + "%!");
                document.getElementById('currentCommission').innerText = val + "%";
            }).catch(error => {
                alert("Error updating commission: " + error.message);
            });
        }
        
        // Fetch Services from API
        async function fetchServicesFromAPI() {
            const category = document.getElementById('catSelect').value;
            const srvSelect = document.getElementById('srvSelect');
            
            if (!category) {
                srvSelect.innerHTML = '<option value="">Select a category first</option>';
                return;
            }
            
            srvSelect.innerHTML = '<option value="">Loading services...</option>';
            
            try {
                const res = await fetch(`${BACKEND_URL}/get-services?category=${encodeURIComponent(category)}`);
                const data = await res.json();
                
                if (!data || data.length === 0) {
                    srvSelect.innerHTML = '<option value="">No services found</option>';
                    return;
                }
                
                srvSelect.innerHTML = '<option value="">Choose Service ▼</option>';
                data.forEach(s => {
                    let apiPrice = parseFloat(s.price) || 0;
                    let finalPrice = apiPrice + (apiPrice * (globalComm / 100));
                    srvSelect.innerHTML += `<option value="${finalPrice}" data-id="${s.id}">${s.name} - ₹${finalPrice.toFixed(2)}/1k</option>`;
                });
                
                calculateAutoPrice();
            } catch (e) {
                console.error("Error fetching services:", e);
                srvSelect.innerHTML = '<option value="">Error loading services</option>';
            }
        }
        
        // Calculate Price
        function calculateAutoPrice() {
            const pricePerK = parseFloat(document.getElementById('srvSelect').value) || 0;
            const quantity = parseFloat(document.getElementById('orderQty').value) || 0;
            const totalPrice = (pricePerK * (quantity / 1000)).toFixed(2);
            document.getElementById('totalPrice').innerText = totalPrice;
        }
        
        // Submit UTR
        function submitUTR() {
            const amt = document.getElementById('amtInp').value;
            const utr = document.getElementById('utrInp').value;
            
            if (!amt || amt <= 0) {
                alert("Please enter a valid amount!");
                return;
            }
            
            if (!utr || utr.trim().length < 8) {
                alert("Please enter a valid UTR/Transaction ID!");
                return;
            }
            
            const user = auth.currentUser;
            if (!user) return;
            
            db.ref('paymentRequests').push({
                uid: user.uid,
                email: user.email,
                amt: parseFloat(amt),
                utr: utr.trim(),
                status: 'pending',
                timestamp: Date.now(),
                name: user.displayName || 'User'
            }).then(() => {
                alert("UTR submitted successfully! Admin will approve it soon.");
                document.getElementById('qrDiv').style.display = 'none';
                document.getElementById('amtInp').value = '';
                document.getElementById('utrInp').value = '';
            }).catch(error => {
                alert("Error submitting UTR: " + error.message);
            });
        }
        
        // Load Admin Panel
        function loadAdminPanel() {
            // Load users
            db.ref('users').on('value', snap => {
                let html = '';
                
                snap.forEach(user => {
                    const data = user.val();
                    const isSelf = user.key === MY_UID;
                    
                    html += `
                        <div class="admin-user-card">
                            <div class="user-info">
                                <h5>${data.email || 'User'}</h5>
                                <div class="user-details">
                                    <span>Bal: ₹${(data.balance || 0).toFixed(2)}</span>
                                    <span>Status: ${data.status || 'Active'}</span>
                                </div>
                            </div>
                            <div class="admin-actions">
                                ${isSelf ? 
                                    '<span style="font-size:12px; color:var(--primary); font-weight:600;">(Admin)</span>' : 
                                    `
                                    <button class="btn-sm btn-primary-sm" onclick="editBal('${user.key}')">Edit Balance</button>
                                    <button class="btn-sm ${data.status === 'blocked' ? 'btn-success-sm' : 'btn-warning-sm'}" onclick="toggleBlock('${user.key}', '${data.status || 'active'}')">
                                        ${data.status === 'blocked' ? 'Unblock' : 'Block'}
                                    </button>
                                    `
                                }
                            </div>
                        </div>
                    `;
                });
                
                document.getElementById('adminUserList').innerHTML = html || '<p style="text-align:center; color:var(--text-light);">No users found</p>';
            });
            
            // Load payment requests
            db.ref('paymentRequests').orderByChild('status').equalTo('pending').on('value', snap => {
                let html = '';
                
                snap.forEach(payment => {
                    const data = payment.val();
                    
                    html += `
                        <div class="admin-user-card">
                            <div class="user-info">
                                <h5>${data.name || data.email || 'User'}</h5>
                                <div class="user-details">
                                    <span>Amount: ₹${data.amt.toFixed(2)}</span>
                                    <span>UTR: ${data.utr}</span>
                                    <span>${new Date(data.timestamp).toLocaleString()}</span>
                                </div>
                            </div>
                            <div class="admin-actions">
                                <button class="btn-sm btn-success-sm" onclick="approveUTR('${payment.key}', '${data.uid}', ${data.amt})">
                                    Approve
                                </button>
                                <button class="btn-sm btn-danger-sm" onclick="rejectUTR('${payment.key}')">
                                    Reject
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                document.getElementById('adminPayments').innerHTML = html || '<p style="text-align:center; color:var(--text-light);">No pending payment requests</p>';
            });
        }
        
        // Admin Functions
        function approveUTR(key, uid, amt) {
            if (!confirm(`Approve payment of ₹${amt.toFixed(2)}?`)) return;
            
            // Update user balance
            db.ref('users/' + uid + '/balance').transaction(current => {
                return (current || 0) + parseFloat(amt);
            });
            
            // Update payment status
            db.ref('paymentRequests/' + key + '/status').set('approved');
            
            alert("Payment approved successfully!");
        }
        
        function rejectUTR(key) {
            if (!confirm("Reject this payment request?")) return;
            db.ref('paymentRequests/' + key).remove();
        }
        
        function editBal(uid) {
            if (uid === MY_UID) {
                alert("Cannot edit admin balance!");
                return;
            }
            
            const newBal = prompt("Enter new balance:");
            if (newBal !== null && !isNaN(parseFloat(newBal))) {
                db.ref('users/' + uid + '/balance').set(parseFloat(newBal));
            }
        }
        
        function toggleBlock(uid, currentStatus) {
            if (uid === MY_UID) {
                alert("Cannot block admin account!");
                return;
            }
            
            const newStatus = currentStatus === 'blocked' ? 'active' : 'blocked';
            const action = newStatus === 'blocked' ? 'Block' : 'Unblock';
            
            if (confirm(`${action} this user?`)) {
                db.ref('users/' + uid + '/status').set(newStatus);
            }
        }
        
        // Load Orders
        function loadOrders() {
            const user = auth.currentUser;
            if (!user) return;
            
            db.ref('orders/' + user.uid).limitToLast(10).on('value', snap => {
                let html = '';
                
                if (!snap.exists()) {
                    html = '<tr><td colspan="5" style="text-align: center; padding: 20px; color: var(--text-light);">No orders yet</td></tr>';
                } else {
                    snap.forEach(order => {
                        const data = order.val();
                        const date = new Date(data.timestamp || Date.now());
                        const statusClass = data.status === 'completed' ? 'status-completed' : 
                                           data.status === 'failed' ? 'status-failed' : 'status-pending';
                        
                        html += `
                            <tr>
                                <td>${order.key.substring(0, 8)}</td>
                                <td>${data.service || 'N/A'}</td>
                                <td>${data.quantity || 0}</td>
                                <td>₹${data.amount || '0.00'}</td>
                                <td class="${statusClass}">${data.status || 'pending'}</td>
                            </tr>
                        `;
                    });
                }
                
                document.getElementById('ordersList').innerHTML = html;
            });
        }
        
        // Load Refill History
        function loadRefillHistory() {
            const user = auth.currentUser;
            if (!user) return;
            
            db.ref('refills/' + user.uid).limitToLast(10).on('value', snap => {
                let html = '';
                
                if (!snap.exists()) {
                    html = '<tr><td colspan="4" style="text-align: center; padding: 20px; color: var(--text-light);">No refill history</td></tr>';
                } else {
                    snap.forEach(refill => {
                        const data = refill.val();
                        const date = new Date(data.timestamp || Date.now());
                        const statusClass = data.status === 'completed' ? 'status-completed' : 
                                           data.status === 'failed' ? 'status-failed' : 'status-pending';
                        
                        html += `
                            <tr>
                                <td>${refill.key.substring(0, 8)}</td>
                                <td>${data.service || 'N/A'}</td>
                                <td>${date.toLocaleDateString()}</td>
                                <td class="${statusClass}">${data.status || 'pending'}</td>
                            </tr>
                        `;
                    });
                }
                
                document.getElementById('refillList').innerHTML = html;
            });
        }
        
        // Load All Services
        async function loadAllServices() {
            try {
                const res = await fetch(`${BACKEND_URL}/get-services`);
                const data = await res.json();
                
                if (!data || data.length === 0) {
                    document.getElementById('allServices').innerHTML = '<p style="text-align: center; color: var(--text-light);">No services available</p>';
                    return;
                }
                
                // Group services by category
                const categories = {};
                data.forEach(service => {
                    if (!categories[service.category]) {
                        categories[service.category] = [];
                    }
                    let apiPrice = parseFloat(service.price) || 0;
                    let finalPrice = apiPrice + (apiPrice * (globalComm / 100));
                    categories[service.category].push({
                        name: service.name,
                        price: finalPrice.toFixed(2),
                        min: service.min || 100,
                        max: service.max || 10000
                    });
                });
                
                let html = '';
                for (const category in categories) {
                    html += `
                        <div style="margin-bottom: 25px;">
                            <h3 style="color: var(--primary); margin-bottom: 15px; border-bottom: 1px solid rgba(99, 102, 241, 0.3); padding-bottom: 5px;">${category}</h3>
                    `;
                    
                    categories[category].forEach(service => {
                        html += `
                            <div style="background: rgba(255, 255, 255, 0.03); padding: 12px; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-weight: 600;">${service.name}</div>
                                    <div style="font-size: 12px; color: var(--text-light);">Min: ${service.min} | Max: ${service.max}</div>
                                </div>
                                <div style="color: var(--accent); font-weight: 700;">₹${service.price}/1k</div>
                            </div>
                        `;
                    });
                    
                    html += `</div>`;
                }
                
                document.getElementById('allServices').innerHTML = html;
            } catch (error) {
                console.error("Error loading services:", error);
                document.getElementById('allServices').innerHTML = '<p style="text-align: center; color: var(--danger);">Error loading services</p>';
            }
        }
        
        // Create Ticket
        function createTicket() {
            const subject = document.getElementById('ticketSubject').value;
            const message = document.getElementById('ticketMessage').value;
            
            if (!subject || !message) {
                alert("Please fill all fields!");
                return;
            }
            
            const user = auth.currentUser;
            if (!user) return;
            
            const ticketId = 'TICKET' + Date.now();
            db.ref('tickets/' + user.uid + '/' + ticketId).set({
                subject: subject,
                message: message,
                status: 'open',
                timestamp: Date.now(),
                email: user.email,
                name: user.displayName || 'User'
            }).then(() => {
                alert("Ticket created successfully!");
                document.getElementById('ticketSubject').value = '';
                document.getElementById('ticketMessage').value = '';
                loadTickets();
            }).catch(error => {
                alert("Error creating ticket: " + error.message);
            });
        }
        
        // Load Tickets
        function loadTickets() {
            const user = auth.currentUser;
            if (!user) return;
            
            db.ref('tickets/' + user.uid).limitToLast(5).on('value', snap => {
                let html = '';
                
                if (!snap.exists()) {
                    html = '<p style="text-align: center; color: var(--text-light); padding: 20px;">No tickets yet</p>';
                } else {
                    snap.forEach(ticket => {
                        const data = ticket.val();
                        const date = new Date(data.timestamp);
                        const statusClass = data.status === 'closed' ? 'status-completed' : 
                                           data.status === 'open' ? 'status-pending' : '';
                        
                        html += `
                            <div style="background: rgba(255, 255, 255, 0.03); padding: 15px; border-radius: 10px; margin-bottom: 10px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                    <div style="font-weight: 600;">${data.subject}</div>
                                    <span class="${statusClass}" style="font-size: 12px;">${data.status || 'open'}</span>
                                </div>
                                <div style="color: var(--text-light); font-size: 14px; margin-bottom: 8px;">${data.message}</div>
                                <div style="font-size: 12px; color: var(--text-light);">${date.toLocaleString()}</div>
                            </div>
                        `;
                    });
                }
                
                document.getElementById('ticketsList').innerHTML = html;
            });
        }
        
        // Load API Key
        function loadAPIKey() {
            const user = auth.currentUser;
            if (!user) return;
            
            db.ref('apiKeys/' + user.uid).once('value').then(snap => {
                if (snap.exists()) {
                    document.getElementById('apiKeyDisplay').innerText = snap.val().key || 'No API key found';
                } else {
                    document.getElementById('apiKeyDisplay').innerText = 'No API key generated yet';
                }
            });
        }
        
        // Generate API Key
        function generateAPIKey() {
            const user = auth.currentUser;
            if (!user) return;
            
            const apiKey = 'DG_' + Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
            
            db.ref('apiKeys/' + user.uid).set({
                key: apiKey,
                created: Date.now()
            }).then(() => {
                document.getElementById('apiKeyDisplay').innerText = apiKey;
                alert("New API key generated successfully!");
            }).catch(error => {
                alert("Error generating API key: " + error.message);
            });
        }
        
        // Load Referral Data
        function loadReferralData() {
            const user = auth.currentUser;
            if (!user) return;
            
            // Generate referral code from user ID
            const referralCode = 'DG' + user.uid.substring(0, 8).toUpperCase();
            const referralLink = window.location.origin + window.location.pathname + '?ref=' + referralCode;
            
            document.getElementById('referralCode').innerText = referralLink;
            
            // Load referral stats
            db.ref('referrals/' + user.uid).once('value').then(snap => {
                const data = snap.val() || { count: 0, earned: 0 };
                document.getElementById('refCount').innerText = data.count || 0;
                document.getElementById('refEarned').innerText = '₹' + (data.earned || 0).toFixed(2);
            });
        }
        
        // Copy Referral Link
        function copyReferralLink() {
            const referralLink = document.getElementById('referralCode').innerText;
            navigator.clipboard.writeText(referralLink).then(() => {
                alert("Referral link copied to clipboard!");
            }).catch(err => {
                alert("Failed to copy: " + err);
            });
        }
        
        // Navigation Functions
        function openPage(pageId, element) {
            // Update pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
            
            // Update sidebar items
            if (element) {
                document.querySelectorAll('.menu-item').forEach(item => {
                    item.classList.remove('active');
                });
                element.classList.add('active');
            }
            
            // Update bottom nav
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            if (pageId === 'home') {
                document.querySelectorAll('.nav-item')[0].classList.add('active');
            } else if (pageId === 'addfund') {
                document.querySelectorAll('.nav-item')[1].classList.add('active');
            } else if (pageId === 'orders') {
                document.querySelectorAll('.nav-item')[2].classList.add('active');
            } else if (pageId === 'support') {
                document.querySelectorAll('.nav-item')[3].classList.add('active');
            }
            
            // Close sidebar on mobile
            toggleSidebar(false);
            
            // Refresh data for certain pages
            if (pageId === 'services') {
                loadAllServices();
            } else if (pageId === 'orders') {
                loadOrders();
            } else if (pageId === 'tickets') {
                loadTickets();
            }
        }
        
        function toggleSidebar(show) {
            const sidebar = document.getElementById('sidebar');
            if (show !== undefined) {
                sidebar.classList.toggle('active', show);
            } else {
                sidebar.classList.toggle('active');
            }
        }
        
        // Auth Functions
        function doGoogleAuth() {
            auth.signInWithPopup(new firebase.auth.GoogleAuthProvider())
                .catch(error => {
                    alert("Google sign-in failed: " + error.message);
                });
        }
        
        function genQR() {
            const amount = document.getElementById('amtInp').value;
            
            if (!amount || amount <= 0) {
                alert("Please enter a valid amount first!");
                return;
            }
            
            const upiId = "aqdaskhan03@fam";
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=upi://pay?pa=${encodeURIComponent(upiId)}&am=${amount}&cu=INR&tn=DG Social Service Payment`;
            
            document.getElementById('qrImg').src = qrUrl;
            document.getElementById('qrDiv').style.display = 'block';
            
            // Scroll to QR
            document.getElementById('qrDiv').scrollIntoView({ behavior: 'smooth' });
        }
        
        function doLogout() {
            if (confirm("Are you sure you want to logout?")) {
                auth.signOut();
            }
        }
        
        function toggleAuth(isLogin) {
            document.getElementById('loginForm').style.display = isLogin ? 'block' : 'none';
            document.getElementById('signupForm').style.display = isLogin ? 'none' : 'block';
        }
        
        function doLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPass').value;
            
            if (!email || !password) {
                alert("Please enter both email and password!");
                return;
            }
            
            auth.signInWithEmailAndPassword(email, password)
                .catch(error => {
                    alert("Login failed: " + error.message);
                });
        }
        
        function doSignup() {
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPass').value;
            
            if (!name || !email || !password) {
                alert("Please fill all fields!");
                return;
            }
            
            if (password.length < 6) {
                alert("Password must be at least 6 characters long!");
                return;
            }
            
            auth.createUserWithEmailAndPassword(email, password)
                .then(result => {
                    // Update profile
                    return result.user.updateProfile({
                        displayName: name
                    }).then(() => {
                        // Create user in database
                        return db.ref('users/' + result.user.uid).set({
                            email: email,
                            name: name,
                            balance: 0,
                            status: 'active',
                            createdAt: Date.now()
                        });
                    });
                })
                .then(() => {
                    alert("Account created successfully! You are now logged in.");
                })
                .catch(error => {
                    alert("Signup failed: " + error.message);
                });
        }
        
        // Place Order
        async function placeFinalOrder() {
            const srvSelect = document.getElementById('srvSelect');
            const serviceId = srvSelect.options[srvSelect.selectedIndex]?.getAttribute('data-id');
            const link = document.getElementById('orderLink').value;
            const qty = document.getElementById('orderQty').value;
            const total = parseFloat(document.getElementById('totalPrice').innerText);
            
            // Validation
            if (!serviceId) {
                alert("Please select a service!");
                return;
            }
            
            if (!link || link.trim().length < 3) {
                alert("Please enter a valid link or username!");
                return;
            }
            
            if (!qty || qty < 10) {
                alert("Quantity must be at least 10!");
                return;
            }
            
            if (total <= 0) {
                alert("Total price must be greater than 0!");
                return;
            }
            
            // Check balance
            const user = auth.currentUser;
            if (!user) return;
            
            const balanceSnap = await db.ref('users/' + user.uid + '/balance').once('value');
            const currentBal = balanceSnap.val() || 0;
            
            if (currentBal < total) {
                alert(`Insufficient balance! You need ₹${total.toFixed(2)} but have only ₹${currentBal.toFixed(2)}`);
                return;
            }
            
            // Confirm order
            if (!confirm(`Confirm order for ₹${total.toFixed(2)}?`)) return;
            
            // Update button
            const orderBtn = document.getElementById('orderBtn');
            const originalText = orderBtn.innerHTML;
            orderBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            orderBtn.disabled = true;
            
            try {
                // Place order with backend
                const res = await fetch(`${BACKEND_URL}/place-order`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        service: serviceId, 
                        link: link.trim(), 
                        quantity: qty 
                    })
                });
                
                const data = await res.json();
                
                if (data.success) {
                    // Deduct balance
                    await db.ref('users/' + user.uid + '/balance').set(currentBal - total);
                    
                    // Save order to user's orders
                    const orderId = 'ORDER' + Date.now();
                    await db.ref('orders/' + user.uid + '/' + orderId).set({
                        service: serviceId,
                        link: link,
                        quantity: qty,
                        amount: total,
                        status: 'pending',
                        timestamp: Date.now()
                    });
                    
                    // Show success
                    alert(`Order placed successfully!\nOrder ID: ${data.orderId || orderId}\nAmount: ₹${total.toFixed(2)}\nRemaining Balance: ₹${(currentBal - total).toFixed(2)}`);
                    
                    // Reset form
                    document.getElementById('orderLink').value = '';
                    document.getElementById('totalPrice').innerText = '0.00';
                    
                } else {
                    alert("Order Error: " + (data.message || "Unknown error"));
                }
                
            } catch (error) {
                console.error("Order error:", error);
                alert("Failed to place order. Please try again later.");
            } finally {
                // Reset button
                orderBtn.innerHTML = originalText;
                orderBtn.disabled = false;
            }
        }
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            // Add click outside sidebar to close
            document.addEventListener('click', function(event) {
                const sidebar = document.getElementById('sidebar');
                const menuToggle = document.querySelector('.menu-toggle');
                
                if (sidebar.classList.contains('active') && 
                    !sidebar.contains(event.target) && 
                    !menuToggle.contains(event.target)) {
                    sidebar.classList.remove('active');
                }
            });
            
            // Close sidebar when clicking on a menu item (for mobile)
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', function() {
                    if (window.innerWidth <= 768) {
                        toggleSidebar(false);
                    }
                });
            });
            
            // Check for referral parameter in URL
            const urlParams = new URLSearchParams(window.location.search);
            const refCode = urlParams.get('ref');
            if (refCode && !auth.currentUser) {
                localStorage.setItem('referralCode', refCode);
            }
        });
    </script>
</body>
</html>
