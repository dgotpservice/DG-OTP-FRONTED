<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DG SMS SERVER</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* CSS Settings for dark theme and UI */
        body { background-color: #0b1120; color: white; font-family: sans-serif; margin: 0; padding: 20px; }
        .container { max-width: 400px; margin: auto; background: #161e2e; padding: 20px; border-radius: 15px; border: 1px solid #1e293b; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .balance-box { background: #1e293b; padding: 8px 15px; border-radius: 20px; color: #10b981; font-weight: bold; }
        select, input, button { width: 100%; padding: 12px; margin-top: 10px; border-radius: 8px; border: none; background: #1f2937; color: white; }
        button { background: #2563eb; cursor: pointer; font-weight: bold; margin-top: 20px; }
        .error { color: #f59e0b; background: #2d2613; padding: 10px; border-radius: 8px; text-align: center; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <i class="fas fa-bars"></i>
        <h3 style="color: #3b82f6; font-style: italic;">DG SMS SERVER</h3>
        <div class="balance-box" id="userBalance">‚Çπ0.00</div>
    </div>

    <div style="background: #111827; padding: 15px; border-radius: 12px;">
        <p style="font-size: 12px; color: #9ca3af; text-transform: uppercase;">Select Country & Service</p>
        
        <select id="countrySelect">
            <option value="0">India (+91)</option>
        </select>

        <input type="text" id="serviceSearch" placeholder="Search Service..." onkeyup="filterServices()">

        <select id="smsSvc">
            <option>üîç Loading Services...</option>
        </select>

        <button onclick="getOTP()">GET OTP NUMBER</button>
    </div>
</div>

<script>
    // 1. Firebase Configuration
    const firebaseConfig = {
        databaseURL: "https://otp-service-74871-default-rtdb.firebaseio.com/"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // 2. Render Backend URL
    const BACKEND = "https://dg-otp-backend.onrender.com";

    // Aapka User ID
    const userUID = "8nfpc1ibBWOGasH830QTdhIOQb23";

    // Realtime Balance update from Firebase
    database.ref('users/' + userUID + '/balance').on('value', (snapshot) => {
        const bal = snapshot.val() || 0;
        document.getElementById('userBalance').innerText = "‚Çπ" + parseFloat(bal).toFixed(2);
    });

    // Fetch services from Render Backend
    async function fetchServices() {
        const select = document.getElementById('smsSvc');
        try {
            const res = await fetch(`${BACKEND}/get-all-services?country=0`);
            const services = await res.json();
            
            if (services.length === 0) throw new Error();

            select.innerHTML = "";
            services.forEach(s => {
                let opt = document.createElement('option');
                opt.value = s.id;
                opt.innerText = `${s.name} - ‚Çπ${s.rate}`;
                select.appendChild(opt);
            });
        } catch (e) {
            select.innerHTML = "<option class='error'>‚ö†Ô∏è Server Error (Check API)</option>";
        }
    }

    function filterServices() {
        let input = document.getElementById('serviceSearch').value.toUpperCase();
        let select = document.getElementById('smsSvc');
        let options = select.getElementsByTagName('option');
        for (let i = 0; i < options.length; i++) {
            let txt = options[i].innerText;
            options[i].style.display = txt.toUpperCase().indexOf(input) > -1 ? "" : "none";
        }
    }

    fetchServices();
</script>

</body>
</html>
